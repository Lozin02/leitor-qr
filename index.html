<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Leitor QR Criptografado</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <h2>Escaneie o QR Code</h2>
  <div id="reader" style="width: 300px;"></div>

  <h3>Senha:</h3>
  <input type="password" id="senha" placeholder="Digite a senha" />
  <button onclick="descriptografar()">Descriptografar</button>

  <h3>Resultado:</h3>
  <pre id="resultado"></pre>

  <script>
    let conteudoCriptografado = "";

    function onScanSuccess(decodedText) {
      conteudoCriptografado = decodedText;
      document.getElementById("resultado").innerText = "QR code lido com sucesso. Agora digite a senha.";
    }

    function descriptografar() {
      const senha = document.getElementById("senha").value;
      try {
        const bytes = CryptoJS.AES.decrypt(conteudoCriptografado, senha);
        const textoOriginal = bytes.toString(CryptoJS.enc.Utf8);
        if (!textoOriginal) throw new Error("Senha incorreta");
        document.getElementById("resultado").innerText = textoOriginal;
      } catch (e) {
        document.getElementById("resultado").innerText = "Erro: senha incorreta ou QR inv√°lido!";
      }
    }

    new Html5Qrcode("reader").start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: 250
      },
      onScanSuccess
    );
  </script>
</body>
</html>
